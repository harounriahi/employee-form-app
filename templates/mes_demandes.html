<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Demandes d'accès</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <style>
        body { background: #f8f9f3; font-family: 'Segoe UI', Arial, sans-serif; }
        .container { max-width: 950px; margin: 40px auto; background: #fff; border-radius: 10px; box-shadow: 0 4px 24px rgba(0,0,0,0.07); padding: 32px; }
        h2 { color: #40806b; margin-bottom: 20px; }
        .role-links { margin-bottom: 18px; }
        .role-links a { color: #40806b; margin-right: 18px; text-decoration: none; font-weight: 500; }
        .role-links a:hover { text-decoration: underline; }
        table { border-collapse: collapse; width: 100%; background: #fafafc; }
        th, td { padding: 12px 10px; text-align: left; border-bottom: 1px solid #ececec; }
        th { background: #e6f2ed; color: #21513c; }
        tr:hover { background: #f1f8f6; }
        .status-pending { color: #e67e22; font-weight: bold; }
        .status-approved { color: #2ecc71; font-weight: bold; }
        .status-rejected { color: #e74c3c; font-weight: bold; }
        .action-btn, .cloture-btn { background: #40806b; color: #fff; border: none; border-radius: 4px; padding: 6px 14px; cursor: pointer; margin-right: 6px; }
        .action-btn.reject { background: #e74c3c; }
        .cloture-btn { background: #888; }
        .action-btn:disabled, .cloture-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Demandes d'accès</h2>
        <div class="role-links">
            <a href="{{ url_for('form') }}">Formulaire de gestion des droits d'accès</a>
            {% if role in ['validateur', 'informatique'] %}
                | <a href="{{ url_for('mes_demandes') }}">Demandes d'accès</a>
            {% endif %}
            {% if role == 'informatique' %}
                | <a href="{{ url_for('register') }}">Ajouter un utilisateur</a>
            {% endif %}
        </div>

        {% if demandes %}
            <table>
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Demandeur</th>
                        <th>Date</th>
                        <th>Statut</th>
                        <th>Motif</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for d in demandes %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td>{{ d.demandeur }}</td>
                        <td>{{ d.date }}</td>
                        <td>
                            {% if d.statut == 'En attente' %}
                                <span class="status-pending">{{ d.statut }}</span>
                            {% elif d.statut == 'Validée' %}
                                <span class="status-approved">{{ d.statut }}</span>
                            {% elif d.statut == 'Clôturée' %}
                                <span class="status-approved" style="color:#888">{{ d.statut }}</span>
                            {% else %}
                                <span class="status-rejected">{{ d.statut }}</span>
                            {% endif %}
                        </td>
                        <td>{{ d.motif }}</td>
                        <td>
                            {% if role in ['validateur', 'informatique'] and d.statut == 'En attente' %}
                                <form method="post" action="{{ url_for('valider_demande', id=d.id) }}" style="display:inline;">
                                    <button type="submit" class="action-btn">Valider</button>
                                </form>
                                <form method="post" action="{{ url_for('rejeter_demande', id=d.id) }}" style="display:inline;">
                                    <button type="submit" class="action-btn reject">Rejeter</button>
                                </form>
                            {% elif role == 'informatique' and d.statut == 'Validée' %}
                                <form method="post" action="{{ url_for('cloturer_demande', id=d.id) }}" style="display:inline;">
                                    <button type="submit" class="cloture-btn">Clôturer</button>
                                </form>
                            {% else %}
                                <button class="action-btn" disabled>Valider</button>
                                <button class="action-btn reject" disabled>Rejeter</button>
                                {% if role == 'informatique' %}
                                    <button class="cloture-btn" disabled>Clôturer</button>
                                {% endif %}
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>Aucune demande trouvée.</p>
        {% endif %}
    </div>
</body>
</html>